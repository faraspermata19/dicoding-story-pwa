/*! For license information please see 525.4ee8e58036e45a170f6b.js.LICENSE.txt */
"use strict";(self.webpackChunkapp_starter_project_with_webpack=self.webpackChunkapp_starter_project_with_webpack||[]).push([[525],{525:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var r=n(481),o=n.n(r),a=(n(849),n(778)),i=n(734);function c(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof l?r:l,s=Object.create(c.prototype);return u(s,"_invoke",function(n,r,o){var a,c,u,l=0,s=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return a=e,c=0,u=t,p.n=n,i}};function d(n,r){for(c=n,u=r,e=0;!f&&l&&!o&&e<s.length;e++){var o,a=s[e],d=p.p,y=a[2];n>3?(o=y===r)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,p.v=r,p.n=a[1]):d<y&&(o=n<3||a[0]>r||r>y)&&(a[4]=n,a[5]=r,p.n=y,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,y){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,y),c=s,u=y;(e=c<2?t:u)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(l=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==i)break}catch(e){a=t,c=1,u=e}finally{l=1}}return{value:e,done:f}}}(n,o,a),!0),s}var i={};function l(){}function s(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(u(e={},r,function(){return this}),e),d=f.prototype=l.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,o,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=f,u(d,"constructor",f),u(f,"constructor",s),s.displayName="GeneratorFunction",u(f,o,"GeneratorFunction"),u(d),u(d,o,"Generator"),u(d,r,function(){return this}),u(d,"toString",function(){return"[object Generator]"}),(c=function(){return{w:a,m:y}})()}function u(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}u=function(t,e,n,r){function a(e,n){u(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},u(t,e,n,r)}function l(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function s(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(t){l(a,r,o,i,c,"next",t)}function c(t){l(a,r,o,i,c,"throw",t)}i(void 0)})}}const f=function(t){return s(c().m(function e(){var n,r,o,a,u,l,s,f,p;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.description,r=t.photo,o=t.lat,a=t.lon,e.n=1,i.G;case 1:return u=e.v,l=u.transaction(i.ai,"readwrite"),s=l.objectStore(i.ai),e.n=2,s.add({description:n,photo:r,lat:o,lon:a,name:"Draft (Offline)",createdAt:(new Date).toISOString()});case 2:return e.n=3,l.done;case 3:if(console.log("Story saved locally for synchronization."),!("serviceWorker"in navigator)||!("SyncManager"in window)){e.n=9;break}return e.n=4,navigator.serviceWorker.ready;case 4:return f=e.v,e.p=5,e.n=6,f.sync.register("sync-new-story");case 6:console.log("Background sync registered: sync-new-story"),e.n=8;break;case 7:e.p=7,p=e.v,console.error("Background sync registration failed:",p);case 8:e.n=10;break;case 9:console.log("Background Sync not supported. Will retry on next online session.");case 10:return e.a(2)}},e,null,[[5,7]])}))()};function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function d(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof c?r:c,l=Object.create(u.prototype);return y(l,"_invoke",function(n,r,o){var a,c,u,l=0,s=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return a=e,c=0,u=t,p.n=n,i}};function d(n,r){for(c=n,u=r,e=0;!f&&l&&!o&&e<s.length;e++){var o,a=s[e],d=p.p,y=a[2];n>3?(o=y===r)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,p.v=r,p.n=a[1]):d<y&&(o=n<3||a[0]>r||r>y)&&(a[4]=n,a[5]=r,p.n=y,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,s,y){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,y),c=s,u=y;(e=c<2?t:u)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(l=2,a){if(c||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=a.return)&&e.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((e=(f=p.n<0)?u:n.call(r,p))!==i)break}catch(e){a=t,c=1,u=e}finally{l=1}}return{value:e,done:f}}}(n,o,a),!0),l}var i={};function c(){}function u(){}function l(){}e=Object.getPrototypeOf;var s=[][r]?e(e([][r]())):(y(e={},r,function(){return this}),e),f=l.prototype=c.prototype=Object.create(s);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,y(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=l,y(f,"constructor",l),y(l,"constructor",u),u.displayName="GeneratorFunction",y(l,o,"GeneratorFunction"),y(f),y(f,o,"Generator"),y(f,r,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(d=function(){return{w:a,m:p}})()}function y(t,e,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}y=function(t,e,n,r){function a(e,n){y(t,e,function(t){return this._invoke(e,n,t)})}e?o?o(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},y(t,e,n,r)}function v(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function b(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function i(t){v(a,r,o,i,c,"next",t)}function c(t){v(a,r,o,i,c,"throw",t)}i(void 0)})}}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,m(r.key),r)}}function m(t){var e=function(t){if("object"!=p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==p(e)?e:e+""}var g=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=b(d().m(function t(){return d().w(function(t){for(;;)if(0===t.n)return t.a(2,'\n      <section class="container">\n        <h1>Tambahkan Cerita Baru</h1>\n        <form id="add-story-form">\n          <div class="form-group">\n            <label for="description">Deskripsi</label>\n            <textarea id="description" name="description" required></textarea>\n          </div>\n          <div class="form-group">\n            <label for="photo">Foto</label>\n            <input type="file" id="photo" name="photo" accept="image/*" required>\n          </div>\n          <div class="form-group">\n            <label>Lokasi Cerita (Opsional)</label>\n            <div id="map-form-container"></div>\n            <input type="hidden" id="latitude" name="lat">\n            <input type="hidden" id="longitude" name="lon">\n          </div>\n          <button type="submit">Tambah Cerita</button>\n        </form>\n      </section>\n    ')},t)})),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=b(d().m(function t(){var e,n,r,i;return d().w(function(t){for(;;)switch(t.n){case 0:e=o().map("map-form-container").setView([-6.2,106.816666],10),o().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(e),r=o().ExtraMarkers.icon({icon:"fa-star",markerColor:"red",shape:"circle",prefix:"fa"}),e.on("click",function(t){n&&e.removeLayer(n),n=o().marker(t.latlng,{icon:r}).addTo(e),document.getElementById("latitude").value=t.latlng.lat,document.getElementById("longitude").value=t.latlng.lng,alert("Lokasi dipilih: ".concat(t.latlng.lat,", ").concat(t.latlng.lng))}),(i=document.querySelector("#add-story-form")).addEventListener("submit",function(){var t=b(d().m(function t(e){var n,r,o,c,u,l,s,p;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e.preventDefault(),n=i.querySelector("#description").value,r=i.querySelector("#photo").files[0],o=i.querySelector("#latitude").value,c=i.querySelector("#longitude").value,(u=JSON.parse(localStorage.getItem("loginResult")))&&u.token){t.n=1;break}return alert("Anda harus login terlebih dahulu."),t.a(2);case 1:if(t.p=1,navigator.onLine){t.n=3;break}return t.n=2,f({description:n,photo:r,lat:o,lon:c});case 2:return alert("Anda sedang offline. Cerita disimpan dan akan dikirim otomatis saat koneksi kembali."),window.location.hash="#/",t.a(2);case 3:return t.n=4,(0,a.vG)({description:n,photo:r,lat:o,lon:c});case 4:return l=t.v,t.n=5,l.json();case 5:(s=t.v).error?alert(s.message):(alert("Cerita berhasil ditambahkan!"),window.location.hash="#/"),t.n=7;break;case 6:t.p=6,p=t.v,console.error(p),alert("Terjadi kesalahan saat menambahkan cerita. Coba lagi atau pastikan koneksi Anda stabil.");case 7:return t.a(2)}},t,null,[[1,6]])}));return function(e){return t.apply(this,arguments)}}());case 1:return t.a(2)}},t)})),function(){return n.apply(this,arguments)})}],e&&h(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}()},734:(t,e,n)=>{n.d(e,{G:()=>i,O_:()=>o,ai:()=>a});var r=n(602),o="story-favorites",a="story-sync",i=(0,r.P2)("dicoding-story-db",1,{upgrade:function(t){t.objectStoreNames.contains(o)||t.createObjectStore(o,{keyPath:"id"}),t.objectStoreNames.contains(a)||t.createObjectStore(a,{keyPath:"id",autoIncrement:!0})}})}}]);
//# sourceMappingURL=525.4ee8e58036e45a170f6b.js.map